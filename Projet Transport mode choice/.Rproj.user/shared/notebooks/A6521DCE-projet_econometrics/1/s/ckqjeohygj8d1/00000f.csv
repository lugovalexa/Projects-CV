"0","## MAPS VISUALISATION "
"0","## DATA OF THE GRENOBLE MAP "
"0","library(rgdal)"
"0","newESRI <- readOGR(dsn = ""FOND_MAP"", layer = ""NewESRI"", verbose = FALSE)"
"0",""
"0","## CALCULATION OF % OF REAL USE OF PUBLIC TRANSPORT (ZONE D'HABITAT)"
"0","filtered = allgre.PB_V2 %>% "
"0","  filter(mode %in% c(31,32), freqtcu %in% c(1,2)) %>% "
"0","  group_by(tir) %>% "
"0","  count(id_depl) %>% summarise(n_trajets = sum(n))"
"0",""
"0","nonfiltered = allgre.PB_V2 %>% "
"0","  group_by(tir) %>% "
"0","  count(id_depl) %>% summarise(n_trajets = sum(n))"
"0",""
"0","percent = merge(filtered, nonfiltered, by = 'tir') %>% "
"0","  mutate(part_public_transport = n_trajets.x/n_trajets.y) %>%"
"0","  rename('cod_sectir' = 'tir') %>% dplyr::select(cod_sectir, part_public_transport) %>% "
"0","  mutate(cod_sectir = as.character(cod_sectir))"
"0",""
"0","## JOIN OF THE MAP AND THE TRIPS"
"0","newESRI@data = left_join(newESRI@data , percent)"
"0","dff = fortify(newESRI) %>% mutate(id = as.numeric(id) + 1)"
"0","newESRI_DF <- merge(dff, as.data.frame(newESRI), by.x = ""id"", by.y = 0)"
"0","newESRI_DF$N_sectir <- gsub('\xe8', 'è', newESRI_DF$N_sectir)"
"0",""
"0",""
"0","## VISUALISATION"
"0","mybreaks <- seq(0, max(newESRI_DF$part_public_transport, na.rm = TRUE), 0.05)"
"0",""
"0","newESRI_DF = newESRI_DF %>% filter(cod_setir_ %in% seq(101, 114))"
"0",""
"0","part1 = ggplot(data = newESRI_DF, aes(x=long, y = lat, group = group)) +"
"0","  geom_polygon(aes(fill = part_public_transport), colour=""darkgray"", size=0.3) +"
"0","  coord_equal() +"
"0","  ggtitle(""Intensité de l'utilisation des transports en commun à Grenoble dans chaque TIR"") +"
"0","  scale_fill_gradient(low = ""#2b9c60"", high = ""#c82c3d"", na.value = 'grey',"
"0","                      breaks = mybreaks) +"
"0","  theme(axis.line=element_blank(),axis.text.x=element_blank(), axis.text.y=element_blank(),"
"0","        axis.ticks=element_blank(), axis.title.x=element_blank(), axis.title.y=element_blank(),"
"0","        panel.background=element_blank(),panel.border=element_blank(),panel.grid.major=element_blank(),"
"0","        panel.grid.minor=element_blank(),plot.background=element_blank(),"
"0","        plot.title = element_text(size = 7),"
"0","        legend.text=element_text(size=7),"
"0","        legend.title = element_text(size=7))"
